---
interface Props {
    numModulo: number;
    modulo: string;
    temario: string[];
}

import ItemAcordeon from "./ItemAcordeon.astro";
import { Icon } from "astro-icon/components";

const { numModulo, modulo, temario } = Astro.props;
---

<article class="Acordeon">
    <button class="Acordeon__Header" id="TemarioHeader">
        Modulo {numModulo} : {modulo}
        <span class="Acordeon__Boton">
            <Icon
                name="ArrowIcon"
                class:list={[{ rotate: numModulo === 1 }]}
                size={21}
            />
        </span>
    </button>
    <div
        class:list={["Acordeon__Contenido", { isOpen: numModulo === 1 }]}
        id="Temario"
    >
        <div style="overflow: hidden;">
            <ul class="Acordeon__lista">
                {
                    temario.map((tema) => {
                        return (
                            <ItemAcordeon
                                tema={tema}
                                colorIcono="rgb(18, 193, 2)"
                            />
                        );
                    })
                }
            </ul>
        </div>
    </div>
</article>

<style lang="scss">
    .Acordeon {
        display: grid;
        border-bottom: 1px solid #636363;

        &__Header {
            padding: 1rem;
            cursor: pointer;
            display: flex;
            text-align: start;
            justify-content: space-between;
            align-items: start;
            font-size: var(--step-0);
            gap: 0.5rem;
            font-weight: 700;
            border: none;
            background-color: transparent;
        }

        &__Contenido {
            display: grid;
            will-change: grid-template-rows;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.2s ease-out;

            &.isOpen {
                grid-template-rows: 1fr;
            }
        }

        &__lista {
            padding-inline: 1rem;
            padding-bottom: 1rem;
            display: grid;
            grid-auto-rows: min-content;
            gap: 0.5rem;
        }

        &__Boton {
            display: flex;
            align-items: center;
            pointer-events: none;
            > svg {
                transform: rotate(180deg);
                transition: transform 0.2s linear;

                &.rotate {
                    transform: rotate(0deg);
                }
            }
        }
    }
</style>

<script>
    const SectionAcordeon = document.getElementById("Section-Acordeon");

    SectionAcordeon.addEventListener("click", (e) => {
        const header = (e.target as HTMLElement).closest(".Acordeon__Header");
        if (!header) return; // Si el clic no fue en el encabezado, salimos

        const contenido = header.nextElementSibling as HTMLElement;

        // Toggle de clase isOpen en el contenido del acordeón
        contenido.classList.toggle("isOpen");
        // contenido.style.willChange = 'auto';

        // Toggle de rotación del icono
        const arrow = header.querySelector("span svg");
        if (arrow) {
            arrow.classList.toggle("rotate");
        }

        contenido.addEventListener(
            "transitionend",
            () => {
                contenido.style.willChange = "auto";
            },
            { once: true },
        );
    });
</script>
